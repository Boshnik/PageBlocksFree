!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).urlParser=t()}(this,function(){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function e(e,t){if("object"!==s(e))return"";var i="",r=0,a=Object.keys(e);if(0===a.length)return"";for(a.sort(),t||(i+="?"+a[0]+"="+e[a[0]],r+=1);r<a.length;r+=1)i+="&"+a[r]+"="+e[a[r]];return i}function t(e){if(void 0!==e){if(e.match(/^(\d+[smhdw]?)+$/)){for(var t=0,i={s:1,m:60,h:3600,d:86400,w:604800},r=e.replace(/([smhdw])/g," $1 ").trim().split(" "),a=0;a<r.length;a+=2)t+=parseInt(r[a],10)*i[r[a+1]||"s"];return t}if(e.match(/^(\d+:?)+$/)){for(var s=0,o=[1,60,3600,86400,604800],p=e.split(":"),n=0;n<p.length;n++)s+=parseInt(p[n],10)*o[p.length-n-1];return s}}return 0}function i(){for(var e=0,t=["parseProvider","parse","bind","create"];e<t.length;e++){var i=t[e];this[i]=this[i].bind(this)}this.plugins={}}var r=i,r=(i.prototype.parseProvider=function(e){e=e.match(/(?:(?:https?:)?\/\/)?(?:[^.]+\.)?(\w+)\./i);return e?e[1]:void 0},i.prototype.parse=function(e){if(void 0!==e){var t=this.parseProvider(e),i=this.plugins[t];if(t&&i&&i.parse)return(t=i.parse.call(i,e,function(e){if("string"!=typeof e)return{};var t={},e=(e=e.split("+").join(" ")).match(/(?:[?](?:[^=]+)=(?:[^&#]*)(?:[&](?:[^=]+)=(?:[^&#]*))*(?:[#].*)?)|(?:[#].*)/);if(null===e)return{};for(var i=e[0].substr(1).split(/[&#=]/),r=0;r<i.length;r+=2)t[decodeURIComponent(i[r])]=decodeURIComponent(i[r+1]||"");return t}(e)))&&((e=t).params&&0===Object.keys(e.params).length&&delete e.params,(t=e).provider=i.provider),t}},i.prototype.bind=function(e){if((this.plugins[e.provider]=e).alternatives)for(var t=0;t<e.alternatives.length;t+=1)this.plugins[e.alternatives[t]]=e},i.prototype.create=function(e){var t,i,r;if("object"===s(e)&&"object"===s(e.videoInfo))return t=e.videoInfo,r=e.params,i=this.plugins[t.provider],r="internal"===r?t.params:r||{},i&&(e.format=e.format||i.defaultFormat,i.formats.hasOwnProperty(e.format))?i.formats[e.format].apply(i,[t,Object.assign({},r)]):void 0},new r),a=e;function o(){this.provider="canalplus",this.defaultFormat="embed",this.formats={embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}o.prototype.parseParameters=function(e){return delete e.vid,e},o.prototype.parse=function(e,t){var i={mediaType:this.mediaTypes.VIDEO,id:t.vid};if(i.params=this.parseParameters(t),i.id)return i},o.prototype.createEmbedUrl=function(e,t){var i;if(e.id&&e.mediaType===this.mediaTypes.VIDEO)return i="http://player.canalplus.fr/embed/",t.vid=e.id,i+a(t)},r.bind(new o);var p=e;function n(){this.provider="coub",this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}n.prototype.parseUrl=function(e){e=e.match(/(?:embed|view)\/([a-zA-Z\d]+)/i);return e?e[1]:void 0},n.prototype.parse=function(e,t){t={mediaType:this.mediaTypes.VIDEO,params:t,id:this.parseUrl(e)};if(t.id)return t},n.prototype.createUrl=function(e,t,i){if(t.id&&t.mediaType===this.mediaTypes.VIDEO)return e+t.id+p(i)},n.prototype.createLongUrl=function(e,t){return this.createUrl("https://coub.com/view/",e,t)},n.prototype.createEmbedUrl=function(e,t){return this.createUrl("//coub.com/embed/",e,t)},r.bind(new n);var d=e,l=t;function m(){this.provider="dailymotion",this.alternatives=["dai"],this.defaultFormat="long",this.formats={short:this.createShortUrl,long:this.createLongUrl,embed:this.createEmbedUrl,image:this.createImageUrl},this.mediaTypes={VIDEO:"video"}}m.prototype.parseParameters=function(e){return this.parseTime(e)},m.prototype.parseTime=function(e){return e.start&&(e.start=l(e.start)),e},m.prototype.parseUrl=function(e){e=e.match(/(?:\/video|ly)\/([A-Za-z0-9]+)/i);return e?e[1]:void 0},m.prototype.parse=function(e,t){t={mediaType:this.mediaTypes.VIDEO,params:this.parseParameters(t),id:this.parseUrl(e)};return t.id?t:void 0},m.prototype.createUrl=function(e,t,i){if(t.id&&t.mediaType===this.mediaTypes.VIDEO)return e+t.id+d(i)},m.prototype.createShortUrl=function(e,t){return this.createUrl("https://dai.ly/",e,t)},m.prototype.createLongUrl=function(e,t){return this.createUrl("https://dailymotion.com/video/",e,t)},m.prototype.createEmbedUrl=function(e,t){return this.createUrl("https://www.dailymotion.com/embed/video/",e,t)},m.prototype.createImageUrl=function(e,t){return delete t.start,this.createUrl("https://www.dailymotion.com/thumbnail/video/",e,t)},r.bind(new m);var c=e,h=t;function u(){this.provider="twitch",this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video",STREAM:"stream",CLIP:"clip"}}u.prototype.seperateId=function(e){return{pre:e[0],id:e.substr(1)}},u.prototype.parseChannel=function(e,t){e=t.channel||t.utm_content||e.channel;return delete t.utm_content,delete t.channel,e},u.prototype.parseUrl=function(e,t,i){return(e=e.match(/(clips\.)?twitch\.tv\/(?:(?:videos\/(\d+))|(\w+)(?:\/clip\/(\w+))?)/i))&&e[2]?t.id="v"+e[2]:i.video?(t.id=i.video,delete i.video):i.clip?(t.id=i.clip,t.isClip=!0,delete i.clip):e&&e[1]&&e[3]?(t.id=e[3],t.isClip=!0):e&&e[3]&&e[4]?(t.channel=e[3],t.id=e[4],t.isClip=!0):e&&e[3]&&(t.channel=e[3]),t},u.prototype.parseMediaType=function(e){var t;return e.id?e.isClip?(t=this.mediaTypes.CLIP,delete e.isClip):t=this.mediaTypes.VIDEO:e.channel&&(t=this.mediaTypes.STREAM),t},u.prototype.parseParameters=function(e){return e.t&&(e.start=h(e.t),delete e.t),e},u.prototype.parse=function(e,t){var i={};return(i=this.parseUrl(e,i,t)).channel=this.parseChannel(i,t),i.mediaType=this.parseMediaType(i),i.params=this.parseParameters(t),i.channel||i.id?i:void 0},u.prototype.createLongUrl=function(e,t){var i="";if(e.mediaType===this.mediaTypes.STREAM&&e.channel)i="https://twitch.tv/"+e.channel;else if(e.mediaType===this.mediaTypes.VIDEO&&e.id)i="https://twitch.tv/videos/"+this.seperateId(e.id).id,t.start&&(t.t=t.start+"s",delete t.start);else{if(e.mediaType!==this.mediaTypes.CLIP||!e.id)return;i=e.channel?"https://www.twitch.tv/"+e.channel+"/clip/"+e.id:"https://clips.twitch.tv/"+e.id}return i+c(t)},u.prototype.createEmbedUrl=function(e,t){var i="https://player.twitch.tv/";if(e.mediaType===this.mediaTypes.STREAM&&e.channel)t.channel=e.channel;else if(e.mediaType===this.mediaTypes.VIDEO&&e.id)t.video=e.id,t.start&&(t.t=t.start+"s",delete t.start);else{if(e.mediaType!==this.mediaTypes.CLIP||!e.id)return;i="https://clips.twitch.tv/embed",t.clip=e.id}return i+c(t)},r.bind(new u);var y=e,f=t;function T(){this.provider="vimeo",this.alternatives=["vimeopro"],this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video"}}T.prototype.parseUrl=function(e){e=e.match(/(?:\/(?:channels\/[\w]+|(?:(?:album\/\d+|groups\/[\w]+)\/)?videos?))?\/(\d+)/i);return e?e[1]:void 0},T.prototype.parseParameters=function(e){return this.parseTime(e)},T.prototype.parseTime=function(e){return e.t&&(e.start=f(e.t),delete e.t),e},T.prototype.parse=function(e,t){t={mediaType:this.mediaTypes.VIDEO,params:this.parseParameters(t),id:this.parseUrl(e)};return t.id?t:void 0},T.prototype.createUrl=function(e,t,i){if(t.id&&t.mediaType===this.mediaTypes.VIDEO)return e=e+t.id,t=i.start,delete i.start,e+=y(i),t&&(e+="#t="+t),e},T.prototype.createLongUrl=function(e,t){return this.createUrl("https://vimeo.com/",e,t)},T.prototype.createEmbedUrl=function(e,t){return this.createUrl("//player.vimeo.com/video/",e,t)},r.bind(new T);var v=e,U=t;function I(){this.provider="wistia",this.alternatives=[],this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl,embedjsonp:this.createEmbedJsonpUrl},this.mediaTypes={VIDEO:"video",EMBEDVIDEO:"embedvideo"}}I.prototype.parseUrl=function(e){e=e.match(/(?:(?:medias|iframe)\/|wvideo=)([\w-]+)/);return e?e[1]:void 0},I.prototype.parseChannel=function(e){e=e.match(/(?:(?:https?:)?\/\/)?([^.]*)\.wistia\./),e=e?e[1]:void 0;if("fast"!==e&&"content"!==e)return e},I.prototype.parseParameters=function(e,t){return e.wtime&&(e.start=U(e.wtime),delete e.wtime),e.wvideo===t.id&&delete e.wvideo,e},I.prototype.parseMediaType=function(e){return e.id&&e.channel?this.mediaTypes.VIDEO:e.id?(delete e.channel,this.mediaTypes.EMBEDVIDEO):void 0},I.prototype.parse=function(e,t){e={id:this.parseUrl(e),channel:this.parseChannel(e)};if(e.params=this.parseParameters(t,e),e.mediaType=this.parseMediaType(e),e.id)return e},I.prototype.createUrl=function(e,t,i){return t.start&&(t.wtime=t.start,delete t.start),i+v(t)},I.prototype.createLongUrl=function(e,t){var i;if(e.id&&e.mediaType===this.mediaTypes.VIDEO)return i="https://"+e.channel+".wistia.com/medias/"+e.id,this.createUrl(e,t,i)},I.prototype.createEmbedUrl=function(e,t){var i;if(e.id&&(e.mediaType===this.mediaTypes.VIDEO||e.mediaType===this.mediaTypes.EMBEDVIDEO))return i="https://fast.wistia.com/embed/iframe/"+e.id,this.createUrl(e,t,i)},I.prototype.createEmbedJsonpUrl=function(e){if(e.id&&(e.mediaType===this.mediaTypes.VIDEO||e.mediaType===this.mediaTypes.EMBEDVIDEO))return"https://fast.wistia.com/embed/medias/"+e.id+".jsonp"},r.bind(new I);var E=e;function b(){this.provider="youku",this.defaultFormat="long",this.formats={embed:this.createEmbedUrl,long:this.createLongUrl,flash:this.createFlashUrl,static:this.createStaticUrl},this.mediaTypes={VIDEO:"video"}}b.prototype.parseUrl=function(e){e=e.match(/(?:(?:embed|sid)\/|v_show\/id_|VideoIDS=)([a-zA-Z0-9]+)/);return e?e[1]:void 0},b.prototype.parseParameters=function(e){return e.VideoIDS&&delete e.VideoIDS,e},b.prototype.parse=function(e,t){e={mediaType:this.mediaTypes.VIDEO,id:this.parseUrl(e),params:this.parseParameters(t)};if(e.id)return e},b.prototype.createUrl=function(e,t,i){if(t.id&&t.mediaType===this.mediaTypes.VIDEO)return e+t.id+E(i)},b.prototype.createEmbedUrl=function(e,t){return this.createUrl("http://player.youku.com/embed/",e,t)},b.prototype.createLongUrl=function(e,t){return this.createUrl("http://v.youku.com/v_show/id_",e,t)},b.prototype.createStaticUrl=function(e,t){return this.createUrl("http://static.youku.com/v1.0.0638/v/swf/loader.swf?VideoIDS=",e,t)},b.prototype.createFlashUrl=function(e,t){if(e.id&&e.mediaType===this.mediaTypes.VIDEO)return"http://player.youku.com/player.php/sid/"+e.id+"/v.swf"+E(t)},r.bind(new b);var w=e,g=t;function L(){this.provider="youtube",this.alternatives=["youtu","ytimg"],this.defaultFormat="long",this.formats={short:this.createShortUrl,long:this.createLongUrl,embed:this.createEmbedUrl,shortImage:this.createShortImageUrl,longImage:this.createLongImageUrl},this.imageQualities={0:"0",1:"1",2:"2",3:"3",DEFAULT:"default",HQDEFAULT:"hqdefault",SDDEFAULT:"sddefault",MQDEFAULT:"mqdefault",MAXRESDEFAULT:"maxresdefault"},this.defaultImageQuality=this.imageQualities.HQDEFAULT,this.mediaTypes={VIDEO:"video",PLAYLIST:"playlist",SHARE:"share",CHANNEL:"channel"}}L.prototype.parseVideoUrl=function(e){e=e.match(/(?:(?:v|vi|be|videos|embed)\/(?!videoseries)|(?:v|ci)=)([\w-]{11})/i);return e?e[1]:void 0},L.prototype.parseChannelUrl=function(e){var t=e.match(/\/channel\/([\w-]+)/);return t?{id:t[1],mediaType:this.mediaTypes.CHANNEL}:(t=e.match(/\/(?:c|user)\/([\w-]+)/))?{name:t[1],mediaType:this.mediaTypes.CHANNEL}:void 0},L.prototype.parseParameters=function(e,t){return(e.start||e.t)&&(e.start=g(e.start||e.t),delete e.t),e.v===t.id&&delete e.v,e.list===t.id&&delete e.list,e},L.prototype.parseMediaType=function(e){if(e.params.list&&(e.list=e.params.list,delete e.params.list),e.id&&!e.params.ci)e.mediaType=this.mediaTypes.VIDEO;else if(e.list)delete e.id,e.mediaType=this.mediaTypes.PLAYLIST;else{if(!e.params.ci)return;delete e.params.ci,e.mediaType=this.mediaTypes.SHARE}return e},L.prototype.parse=function(e,t){var i=this.parseChannelUrl(e);return i||((i={params:t,id:this.parseVideoUrl(e)}).params=this.parseParameters(t,i),this.parseMediaType(i))},L.prototype.createShortUrl=function(e,t){if(e.id&&e.mediaType===this.mediaTypes.VIDEO)return e="https://youtu.be/"+e.id,t.start&&(e+="#t="+t.start),e},L.prototype.createLongUrl=function(e,t){var i="",r=t.start;if(delete t.start,e.mediaType===this.mediaTypes.CHANNEL)if(e.id)i+="https://www.youtube.com/channel/"+e.id;else{if(!e.name)return;i+="https://www.youtube.com/c/"+e.name}else if(e.mediaType===this.mediaTypes.PLAYLIST&&e.list)t.feature="share",i+="https://www.youtube.com/playlist";else if(e.mediaType===this.mediaTypes.VIDEO&&e.id)t.v=e.id,i+="https://www.youtube.com/watch";else{if(e.mediaType!==this.mediaTypes.SHARE||!e.id)return;t.ci=e.id,i+="https://www.youtube.com/shared"}return e.list&&(t.list=e.list),i+=w(t),e.mediaType!==this.mediaTypes.PLAYLIST&&r&&(i+="#t="+r),i},L.prototype.createEmbedUrl=function(e,t){var i="https://www.youtube.com/embed";if(e.mediaType===this.mediaTypes.PLAYLIST&&e.list)t.listType="playlist";else{if(e.mediaType!==this.mediaTypes.VIDEO||!e.id)return;i+="/"+e.id,"1"===t.loop&&(t.playlist=e.id)}return e.list&&(t.list=e.list),i+w(t)},L.prototype.createImageUrl=function(e,t,i){if(t.id&&t.mediaType===this.mediaTypes.VIDEO)return e+t.id+"/"+(i.imageQuality||this.defaultImageQuality)+".jpg"},L.prototype.createShortImageUrl=function(e,t){return this.createImageUrl("https://i.ytimg.com/vi/",e,t)},L.prototype.createLongImageUrl=function(e,t){return this.createImageUrl("https://img.youtube.com/vi/",e,t)},r.bind(new L);var D=e,A=t;function O(){this.provider="soundcloud",this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={TRACK:"track",PLAYLIST:"playlist",APITRACK:"apitrack",APIPLAYLIST:"apiplaylist"}}O.prototype.parseUrl=function(e,t){e=e.match(/(?:m\.)?soundcloud\.com\/(?:([\w-]+)\/(sets\/)?)([\w-]+)/i);return e&&(t.channel=e[1],"playlists"===e[1]||e[2]?t.list=e[3]:t.id=e[3]),t},O.prototype.parseParameters=function(e){return e.t&&(e.start=A(e.t),delete e.t),e},O.prototype.parseMediaType=function(e){return e.id&&("tracks"===e.channel?(delete e.channel,delete e.params.url,e.mediaType=this.mediaTypes.APITRACK):e.mediaType=this.mediaTypes.TRACK),e.list&&("playlists"===e.channel?(delete e.channel,delete e.params.url,e.mediaType=this.mediaTypes.APIPLAYLIST):e.mediaType=this.mediaTypes.PLAYLIST),e},O.prototype.parse=function(e,t){var i={};if((i=this.parseUrl(e,i)).params=this.parseParameters(t),(i=this.parseMediaType(i)).id||i.list)return i},O.prototype.createLongUrl=function(e,t){var i="",r=t.start;if(delete t.start,e.mediaType===this.mediaTypes.TRACK&&e.id&&e.channel)i="https://soundcloud.com/"+e.channel+"/"+e.id;else if(e.mediaType===this.mediaTypes.PLAYLIST&&e.list&&e.channel)i="https://soundcloud.com/"+e.channel+"/sets/"+e.list;else if(e.mediaType===this.mediaTypes.APITRACK&&e.id)i="https://api.soundcloud.com/tracks/"+e.id;else{if(e.mediaType!==this.mediaTypes.APIPLAYLIST||!e.list)return;i="https://api.soundcloud.com/playlists/"+e.list}return i+=D(t),r&&(i+="#t="+r),i},O.prototype.createEmbedUrl=function(e,t){var i="https://w.soundcloud.com/player/";if(delete t.start,e.mediaType===this.mediaTypes.APITRACK&&e.id)t.url="https%3A//api.soundcloud.com/tracks/"+e.id;else{if(e.mediaType!==this.mediaTypes.APIPLAYLIST||!e.list)return;t.url="https%3A//api.soundcloud.com/playlists/"+e.list}return i+D(t)},r.bind(new O);var P=e;function V(){this.provider="teachertube",this.alternatives=[],this.defaultFormat="long",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video",AUDIO:"audio",DOCUMENT:"document",CHANNEL:"channel",COLLECTION:"collection",GROUP:"group"}}V.prototype.parse=function(e,t){var i={},t=(i.list=this.parsePlaylist(t),i.params=t,e.match(/\/(audio|video|document|user\/channel|collection|group)\/(?:[\w-]+-)?(\w+)/));if(t)return i.mediaType=this.parseMediaType(t[1]),i.id=t[2],i},V.prototype.parsePlaylist=function(e){var t;if(e["playlist-id"])return t=e["playlist-id"],delete e["playlist-id"],t},V.prototype.parseMediaType=function(e){switch(e){case"audio":return this.mediaTypes.AUDIO;case"video":return this.mediaTypes.VIDEO;case"document":return this.mediaTypes.DOCUMENT;case"user/channel":return this.mediaTypes.CHANNEL;case"collection":return this.mediaTypes.COLLECTION;case"group":return this.mediaTypes.GROUP}},V.prototype.createLongUrl=function(e,t){var i;if(e.id)return i="https://www.teachertube.com/",e.list&&(t["playlist-id"]=e.list),e.mediaType===this.mediaTypes.CHANNEL?i+="user/channel/":i+=e.mediaType+"/",(i+=e.id)+P(t)},V.prototype.createEmbedUrl=function(e,t){if(e.id){var i="https://www.teachertube.com/embed/";if(e.mediaType===this.mediaTypes.VIDEO||e.mediaType===this.mediaTypes.AUDIO)return(i+=e.mediaType+"/"+e.id)+P(t)}},r.bind(new V);var S=e;function C(){this.provider="tiktok",this.defaultFormat="long",this.formats={long:this.createLongUrl},this.mediaTypes={VIDEO:"video"}}C.prototype.parse=function(e,t){t={params:t,mediaType:this.mediaTypes.VIDEO},e=e.match(/@([^/]+)\/video\/(\d{19})/);if(e)return t.channel=e[1],t.id=e[2],t},C.prototype.createLongUrl=function(e,t){var i="";if(e.mediaType===this.mediaTypes.VIDEO&&e.id&&e.channel)return(i+="https://www.tiktok.com/@".concat(e.channel,"/video/").concat(e.id))+S(t)},r.bind(new C);var M=e;function k(){this.provider="ted",this.formats={long:this.createLongUrl,embed:this.createEmbedUrl},this.mediaTypes={VIDEO:"video",PLAYLIST:"playlist"}}return k.prototype.parseUrl=function(e,t){var e=e.match(/\/(talks|playlists\/(\d+))\/([\w-]+)/),i=e?e[1]:void 0;return i&&(t.channel=i.split("/")[0],t.id=e[3],"playlists"===t.channel)&&(t.list=e[2]),t},k.prototype.parseMediaType=function(e){return e.id&&"playlists"===e.channel&&(delete e.channel,e.mediaType=this.mediaTypes.PLAYLIST),e.id&&"talks"===e.channel&&(delete e.channel,e.mediaType=this.mediaTypes.VIDEO),e},k.prototype.parse=function(e,t){e=this.parseUrl(e,{params:t});if((e=this.parseMediaType(e)).id)return e},k.prototype.createLongUrl=function(e,t){var i="";if(e.mediaType===this.mediaTypes.VIDEO&&e.id)i+="https://ted.com/talks/"+e.id;else{if(e.mediaType!==this.mediaTypes.PLAYLIST||!e.id)return;i+="https://ted.com/playlists/"+e.list+"/"+e.id}return i+M(t)},k.prototype.createEmbedUrl=function(e,t){var i="https://embed.ted.com/";if(e.mediaType===this.mediaTypes.PLAYLIST&&e.id)i+="playlists/"+e.list+"/"+e.id;else{if(e.mediaType!==this.mediaTypes.VIDEO||!e.id)return;i+="talks/"+e.id}return i+M(t)},r.bind(new k),r});