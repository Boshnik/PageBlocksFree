PageBlocks.grid.Block=function(e){(e=e||{}).id||(e.id="pb-grid-blocks"),Ext.applyIf(e,{baseParams:{action:"web/block/getlist",model_type:e.model_type||PageBlocks.resource.class_key,model_id:e.model_id||0,context_key:PageBlocks.resource.context_key||MODx.config.default_context,deleted:0,sort:"menuindex",dir:"asc"},ddAction:"web/block/sort",multi_select:!0}),PageBlocks.grid.Block.superclass.constructor.call(this,e)},Ext.extend(PageBlocks.grid.Block,PageBlocks.grid.Default,{windows:{},getFields:function(){return["id","block_name","model_id","chunk","published","actions","values"]},getColumns:function(){return[{header:_("pb_grid_id"),dataIndex:"id",sortable:!0,width:75,fixed:!0},{header:_("pb_block_name"),dataIndex:"block_name",sortable:!1,width:150,fixed:!0},{header:_("pb_block_values"),dataIndex:"values",sortable:!1,width:"auto",fixed:!1,renderer:e=>e},{header:_("pb_block_chunk"),dataIndex:"chunk",sortable:!1,width:150,fixed:!0},{header:_("pb_grid_published"),dataIndex:"published",renderer:PageBlocks.utils.renderBoolean,sortable:!0,width:120,fixed:!0},{header:_("pb_grid_actions"),dataIndex:"actions",renderer:PageBlocks.utils.renderActions,sortable:!1,width:200,fixed:!0,id:"actions",hidden:"2"!==PageBlocks.config.modxversion}]},createObject:function(e,s){PageBlocks.utils.request({action:"mgr/block/getlist",resource_id:PageBlocks.resource.id,parent_id:PageBlocks.resource.parent,template_id:PageBlocks.resource.template,sort:"menuindex",dir:"asc",combo:1,limit:0},e=>{this.viewAddBlock&&this.viewAddBlock.destroy(),this.viewAddBlock=MODx.load({xtype:"pb-block-window-list",id:Ext.id(),record:e.results,listeners:{success:{fn:function(){this.refresh()},scope:this}}}),this.viewAddBlock.reset(),this.viewAddBlock.show(s.target)})},updateObject:function(e,o,s){if(void 0!==s)this.menu.record=s.data;else if(!this.menu.record)return!1;PageBlocks.utils.request({action:"web/block/get",id:this.menu.record.id},e=>{var s=MODx.load({xtype:"pb-block-window-update",id:Ext.id(),record:e.object,block_fields:e.object.block_fields,listeners:{success:{fn:function(){this.refresh()},scope:this}}});s.reset(),s.setValues(e.object),s.show(o.target)})},copyBlockId:function(){var e=MODx.load({xtype:"pb-copy-block-id",id:Ext.id(),listeners:{success:{fn:function(){this.refresh()},scope:this}}});e.reset(),e.setValues({model_type:PageBlocks.resource.class_key,model_id:PageBlocks.resource.id,context_key:PageBlocks.resource.context_key}),e.show()},copyBlocksResource:function(){var e=MODx.load({xtype:"pb-copy-blocks-resource",id:Ext.id(),listeners:{success:{fn:function(){this.refresh()},scope:this}}});e.reset(),e.setValues({method_path:"block/copy",model_type:PageBlocks.resource.class_key,model_id:PageBlocks.resource.id,context_key:PageBlocks.resource.context_key}),e.show()},getTopBar:function(){var e=[{text:'<i class="icon icon-plus"></i>&nbsp;'+_("pb_row_create"),handler:this.createObject,cls:"pb-topbar",scope:this}],s=[];return s.push({text:'<i class="icon icon-copy"></i> '+_("pb_copy_block_id"),cls:"pb-bar-cog",handler:this.copyBlockId,scope:this},{text:'<i class="icon icon-copy"></i> '+_("pb_copy_blocks_resource"),cls:"pb-bar-cog",handler:this.copyBlocksResource,scope:this}),s.length&&e.push({text:'<i class="icon icon-cog"></i> ',menu:s}),e.push("->"),e.push(this.getSearchField()),e}}),Ext.reg("pb-grid-blocks",PageBlocks.grid.Block);